<% content_for(:title, "Visualizer â€” Tuner") %>

<div data-controller="visualizer"
     class="fixed inset-0 bottom-20 bg-gray-950 z-20 flex flex-col"
     role="region" aria-label="Audio visualizer">

  <!-- Top bar -->
  <div class="flex items-center justify-between px-4 py-3 z-10">
    <a href="<%= root_path %>" class="text-gray-400 hover:text-white p-1" aria-label="Close visualizer" data-turbo-action="advance">
      <svg class="w-6 h-6" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
    </a>
    <div class="flex items-center gap-1">
      <button data-action="click->visualizer#prevMode" aria-label="Previous visualization mode"
              class="text-gray-400 hover:text-white p-1">
        <svg class="w-4 h-4" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
      </button>
      <span data-visualizer-target="modeLabel" class="text-gray-400 text-sm min-w-[5rem] text-center">
        Frequency
      </span>
      <button data-action="click->visualizer#nextMode" aria-label="Next visualization mode"
              class="text-gray-400 hover:text-white p-1">
        <svg class="w-4 h-4" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Canvas -->
  <div class="flex-1 relative" data-visualizer-target="canvasContainer">
    <canvas data-visualizer-target="canvas" class="absolute inset-0 w-full h-full"></canvas>

    <!-- Activate overlay (shown when AudioContext is suspended) -->
    <div data-visualizer-target="activateOverlay" class="hidden absolute inset-0 flex items-center justify-center bg-gray-950/80 z-10">
      <button data-action="click->visualizer#activate" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg text-lg font-medium">
        Activate Audio
      </button>
    </div>

    <!-- No song playing message -->
    <div data-visualizer-target="emptyState" class="hidden absolute inset-0 flex items-center justify-center">
      <p class="text-gray-500 text-lg">No song playing</p>
    </div>
  </div>

</div>
