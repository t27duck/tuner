<div class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-bold">Albums</h1>
  <span class="text-gray-400 text-sm"><%= @albums.total_count %> albums</span>
</div>

<div class="mb-6">
  <%= form_with url: albums_path, method: :get, class: "flex gap-3", data: { turbo_action: "replace" } do %>
    <div class="flex-1">
      <input type="search" name="q" value="<%= params[:q] %>" placeholder="Search albums..." class="w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 text-gray-100 text-sm focus:outline-none focus:border-blue-500" aria-label="Search albums">
    </div>
    <button type="submit" class="bg-blue-600 hover:bg-blue-500 text-white text-sm px-4 py-2 rounded cursor-pointer" aria-label="Search">Search</button>
    <% if params[:q].present? %>
      <%= link_to "Clear", albums_path, class: "text-gray-400 hover:text-gray-200 text-sm px-3 py-2" %>
    <% end %>
  <% end %>
</div>

<% if @albums.any? %>
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
    <% @albums.each do |album| %>
      <% album_id = album.album_name == "Unknown Album" ? "_unknown" : album.album_name %>
      <%= link_to album_path(album_id), class: "bg-gray-900 border border-gray-800 rounded-lg overflow-hidden hover:border-gray-700 transition-colors block group" do %>
        <div class="aspect-square bg-gray-800 relative overflow-hidden">
          <img src="<%= album_art_song_path(album.representative_song_id) %>"
               alt="Album art for <%= album.album_name %>"
               loading="lazy"
               class="w-full h-full object-cover"
               onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
          <div class="absolute inset-0 items-center justify-center bg-gray-800 text-gray-600" style="display:none">
            <svg class="w-16 h-16" aria-hidden="true" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2z"/></svg>
          </div>
        </div>
        <div class="p-3">
          <div class="font-medium text-gray-100 truncate group-hover:text-blue-400"><%= album.album_name %></div>
          <% artists = album.artist_list.to_s.split(",").map(&:strip).compact_blank.uniq %>
          <div class="text-sm text-gray-400 truncate">
            <% if artists.any? %>
              <%= artists.first(3).join(", ") %><%= ", ..." if artists.size > 3 %>
            <% else %>
              Unknown Artist
            <% end %>
          </div>
          <div class="text-xs text-gray-500 mt-1"><%= album.song_count %> <%= "song".pluralize(album.song_count) %></div>
        </div>
      <% end %>
    <% end %>
  </div>
<% else %>
  <div class="text-center py-12">
    <p class="text-gray-400">No albums found.</p>
  </div>
<% end %>

<%= paginate @albums %>
